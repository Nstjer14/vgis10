\graphicspath{{figures/intro/}}
\chapter{Background}\label{ch:intro}

\begin{itemize}
	\item Model organisms in general
	\item What is a model organism and what are they used for?
	\item Why are zebrafish exciting?
	\begin{itemize}
		\item Similarity with humans
		\item Cost and maintenance
	\end{itemize}
%	\item \textbf{Problem}: "No good automated solutions have been developed for tracking zebrafish reliably in 3D, which makes it difficult for researchers to do large scale behavioural experiments." 
\end{itemize}

In the world of biological and medical research, tests and experiments are performed on animals before any applications to human can be done. This is due to ethical aspects, feasibility, and potential harm and fatalities.The type of animals used in research are known as model organisms, as they often model the biology of human. An example of a model organism is mice, which are often used to study medical treatments for humans, as they share some genetic sequences with human \citep{Perlman2016, RahmanKhan2018}. 
In general, a model organism is not just animals relatable to human genetics, but multiple different kinds of organisms, such as fungi and plants. The requirement is them having a similarity to the organism they are modelling \citep{Hedges2002}.\\

Another example of an animal model is the zebrafish. Zebrafish and humans share a lot of pathways which control development of the central nervous system, and since the embryo of the zebrafish is clear, it enables observation of the development in the early stages. It also have a $70\%$ disease gene similarity to humans. 

The zebrafish is highly used as an animal model, not only due to the similarities to humans, but also due to size and cost. The zebrafish is much smaller than a mouse and the maintenance of the animal is lower due to this, and more fish can be kept on the same amount of space than mice.
The adult zebrafish can lay up to $200$ eggs each week if kept in optimal conditions, which means acquirement of new test subjects will not present it self as an issue.

While being a good model organism for humans, the zebrafish is also used as a model organism for aquaculture species in areas such as, development, diseases, and behavioural tendencies among aquaculture.\\ 


\section{Behavioural Analysis of Zebrafish}

\begin{itemize}
	\item Zebrafish are social
	\item Shoaling vs schooling
	\item Swimming patterns
	\item Drug testing, why? What happens? How do you determine something has happened?
	\item \textbf{Problem}: "No good automated solutions have been developed for tracking zebrafish reliably in 3D, which makes it difficult for researchers to do large scale behavioural experiments."
\end{itemize}

Zebrafish are very social animals and have tendencies to form groups \citep{RahmanKhan2018}. An aggregation of zebrafish can be either a shoal or a school depending on whether the zebrafish are interacting socially or not. When an aggregation of zebrafish is due to social interaction, the zebrafish are shoaling and the swimming pattern is chaotic, but when zebrafish are schooling, the swimming pattern is tightly coordinated and organised \citep{Miller2012a}. Identification of the swimming pattern can thereby be studied to investigate social phenotypes and behavioural patterns when affected by a certain drug or pheromone \citep{RahmanKhan2018}. 

\cite{Kalueff2013} describes multiple scenarios in which the zebrafish is prone to sudden changes in both speed and direction. Depending on the situation, the zebrafish can move very erratic often reflecting a state of anxiety or fear. Furthermore, sudden bursts can also occur in an attempt to attack another fish, often connected to social dominance \citep{Kalueff2013}.

As mentioned, the zebrafish is also used to test the general behaviour when affected by a drug. This is done by having a control group of zebrafish and recording the normal behaviour in an aquarium and then testing this behaviour against an drug affected behaviour \citep{Stewart2015}. \autoref{fig:drug_effect} shows an example of swimming patterns of zebrafish under influence of different drugs made by \cite{Stewart2015}. It is clear how the drugs changes the swimming patterns of a zebrafish, which may be transferable to how it will affect humans as well.\\ 

\begin{figure}[h]
	\centering
	\includegraphics[width=0.8\textwidth]{drug_effect}
	\caption{Zebrafish swimming behaviour under influence of drugs, by \cite{Stewart2015}}
	\label{fig:drug_effect}
\end{figure}



\section{Tracking of Zebrafish}

\begin{itemize}
	\item General setup - aquarium, camera, recordings
	\item Automated or manual annotations - what is trajectories
	\item Tracking requires? - What kinds of detection
	\item More fish, leads to occlusions
	\item Occlusion occurred, now what? - Manual vs automated
	\item Predictions - how is it done?	
\end{itemize}

To investigate the difference in behavioural patterns, i.e. due to drugs, each zebrafish must be detected individually over time. Detection of the zebrafish is often done with automated tracking system, as done by \cite{Stewart2015}, as manual annotation of the data often proves infeasible.

\subsection{Tracking Requirements}
Talk about different viewpoints - side view, top view, advantages and disadvantages.\\
FPS "requirements" - refer to Malte's report?\\
Pre processing?\\

In order to be able to track zebrafish, collection of data is firstly necessary. Recording of the zebrafish is done using one or more cameras either from the top of the aquarium or looking into the aquarium from the side.

Due to the erratic movement of the zebrafish, the higher the \gls{fps} the camera is able to capture video at, the better, as this will increase the probability of the camera capturing every movement of the fish. \cite{Pedersen2017} states, that even at 240 \gls{fps} the zebrafish is still somewhat blurred when accelerating, which can lead to a lower detection rate.

Using the top down view of the aquarium when recording, is often used when using a single camera setup. The top view takes advantage of the uniform and rigid head physiology of the zebrafish. Even though the zebrafish is able to contort it's body, the head most often remains the same, when using the top view. Examples of the rigid head is shown in \autoref{fig:rigid_head}.

\begin{figure}[H]
	\centering
	\begin{subfigure}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{head_straight}
		\label{fig:head_straight}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{head_bend}
		\label{fig:head_bend}
	\end{subfigure}
	\begin{subfigure}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{head_bend2}
		\label{fig:head_bend2}
	\end{subfigure}
\caption{Examples of the rigid head of the zebrafish in different grades og contortions of the body}
\label{fig:rigid_head}
\end{figure}

The data shown in \autoref{fig:rigid_head}, is captured from above the aquarium with a \gls{nir} backlight beneath the aquarium.\\

When recording from the side of the aquarium more details of the fish is available, as the zebrafish has uniquely coloured stripes on both sides, which can be used to identify the zebrafish \citep{Karpova2018}.

According to \cite{Qian2017}, due to the shape of the zebrafish, it generally takes up more space when filmed from the side than from a top view. Furthermore, when the zebrafish turns towards or away from the camera, the shape will be very different than when looking at the side of the zebrafish \citep{Pedersen2017}. Examples of both a regular side view and some issues from the view is shown in \autoref{fig:side_view}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{side_view}
	\caption{Examples of positions of zebrafish in the side view. Image from \cite{Pedersen2017}}
	\label{fig:side_view}
\end{figure}

When data is acquired, it will need to be prepared before tracking or annotation is done. 

\subsection{Annotating Data}
General annotations, but also different "focus points" on the fish. What coordinate is extracted?\\
Kinds of detections.\\

Annotating data using an automated solution can also be defined as a tracking system, whereas annotating data may be understood as manually mark each zebrafish in every frame of the video. 

A tracking system can be split into multiple steps:

\begin{itemize}
	\item Pre processing
	\item Detection
	\item Create trajectories
\end{itemize}

\subsubsection{Pre Processing}
When making operations on a video, the file is split into individual frames, and every frame is treated as an individual image. Before locating of the zebrafish in the image is done, some pre processing of the image is performed. This often includes removing the background and noise from the image.

This is done to ease the process of locating the zebrafish as it will be isolated in the image.

\subsubsection{Detection}
Detection of the zebrafish is done in multiple different ways. A detection will ultimately produce a single point in the image.

Head detection of the zebrafish is often an approach used due to the rigid head of the zebrafish. This means the head will keep the same shape while swimming, whereas the rest of the body may change shape, which will make it harder to detect if focus is on the entire zebrafish.

Other examples of detection, are centre of mass of the zebrafish or extracting a skeleton of the zebrafish, representing the shape of the object with a line. Finding the centre of mass of the zebrafish, if not being limited, may end up outside of the object if it is bending into a shape looking like a C.

Examples of extracted points from detections are shown in \autoref{fig:det_point}.

\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{det_point}
	\caption{Examples of extracted points from detections}
	\label{fig:det_point}
\end{figure}

\subsubsection{Create Trajectories}
When the desired point in the zebrafish is extracted, the point needs to be linked together to create a trajectory. If only a single zebrafish is present in the aquarium no identification is necessary, as every point found belongs to one individual.

As soon as multiple fish are present in the aquarium at the same time, a decision need to made to connect the previous frame's detections to the new ones in the current frame. This can be done by predicting where each individual will be in the following frame based on a state vector and experience from previous frames as input to a Kalman filter, which then makes a qualified guess based on statistics of the new positions. Besides a Kalman filter, a simple cost function such as the Hungarian algorithm can be applied.\\

An issue occurring when multiple zebrafish are in the same aquarium, is when two or more individuals lie close enough together, or on top of each other, to confuse or trick the predictive and cost algorithm.

\subsection{Occlusions}
According to  \cite{Green2012} the use of automated tracking systems perform with same accuracy as manual annotations but in a faster manner. However, they state that automated tracking systems have complications e.g. occlusions. An occlusion is an overlap of two objects in an automated tracking system, and due to the social behaviour of the zebrafish, occlusions occur often when zebrafish are tracked.

\subsection{Handling Occlusions}
According to a study by \cite{Qian2017}, occlusions will occur both while recording from above and from the side of an aquarium, but with greater occurrence from the side of the aquarium due to the shape of the zebrafish. When an occlusion occurs, the trajectory and unique ID of a zebrafish can be lost and will need re-identification either automatically or manually. If the re-identification is not done correctly, the zebrafish could be given a new or wrong ID which will complicate the tracking data \citep{Feijo2018}. This is shown in \autoref{fig:re-id_Ex}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{re_id_ex}
	\caption{Re-ID scenario due to occlusion}
	\label{fig:re-id_Ex}
\end{figure}

Not all occlusions will cause the same types of complications, and some occlusions do not cause any disruption of the trajectory. This is determined by the detection system deployed to track the zebrafish. If the detection of a zebrafish is centred at the head, no occlusion will be detected when the bodies of two zebrafish overlap, however, if detection is done by skeletonisation of the zebrafish, an occlusion will occur (Fig. 2).\\

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\textwidth]{system_dep_occl}
	\caption{Different types of detection leads to different types of occlusion}
	\label{fig:system_dep_occl}
\end{figure}

A solution to missing tracking data due to occlusions, is to re-link parts of the trajectories (tracklets) to create complete trajectories. This can be done by computing a state vector for each zebrafish and using a Kalman filter which makes predictions of the fish’s position, and thereby estimate what ID belongs to the different zebrafish after an occlusion \citep{Feijo2018, Qian2014}.



To avoid patching in missing data, another more feasible solution could be made to solve occlusions before they occur by detecting the zebrafish in each frame. Both \cite{Romero-Ferrero2019} and \cite{Dolado2014} propose solutions which detect occlusions in an effort to solve them using computer vision. \cite{Dolado2014} has categorised occlusion types by how the zebrafish overlap each other in an effort to specify the solution. However, the only way they solve the occlusions are through a two-step trial and error process i.e. if the first step does not solve the solution, the second step is applied, without factoring in the occlusion type. 
However, a novel approach could be to recognise an occlusion type in order to apply a predefined optimal solution.

\section{Problem Specification}
In order to be able to categorise different occlusions for system, a detection and classification of occlusions is necessary.

To solve this, some preliminary questions are set up:
\begin{itemize}
	\item How do we detect an occlusion in an image?
	\item How can the occlusion be categorised?
	\item Which types of occlusions are the most frequently occurring?
	\item What solution techniques are there? 
	\item What solution techniques Can be applied to each occlusion type?
\end{itemize}